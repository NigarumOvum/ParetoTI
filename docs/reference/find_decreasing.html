<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Find features that are decreasing functions of distance from archetype — find_decreasing • ParetoTI</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Find features that are decreasing functions of distance from archetype — find_decreasing" />

<meta property="og:description" content="find_decreasing() Fits gam models to find features that are a decreasing function of distance from archetype. Both gam functions and first derivatives can be visualised using plot() method.
fit_arc_gam_1() Finds single GAM model fit and it's first derivative for a single feature and one or several archetypes.
get_top_decreasing() Find genes highest at each archetype above p-values threshold, and print top-12 genes and top-3 gene sets for each archetype.
find_decreasing_wilcox() find features that are a decreasing function of distance from archetype by finding features with highest value (median) in bin closest to archetype (1 vs all Wilcox test).
bin_cells_by_arch() find which cells are in bin closest to archetype.
find_tradeoff_wilcox(): find features that are most different between 2 archetypes (at a tradeoff, DE, differentially expressed genes) by finding features with highest value (median) in bin closest to archetype (1 vs all Wilcox test)." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ParetoTI</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.12</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/Comparison_to_kmeans.html">Comparison of achetypal analysis and k-means clustering</a>
    </li>
    <li>
      <a href="../articles/Hepatocyte_example.html">Example of using archetypal analysis to find representative cells &amp; describe heterogeniety in hepatocyte population between those archetypes</a>
    </li>
  </ul>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Find features that are decreasing functions of distance from archetype</h1>
    
    <div class="hidden name"><code>find_decreasing.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p><code>find_decreasing()</code> Fits gam models to find features that are a decreasing function of distance from archetype. Both gam functions and first derivatives can be visualised using plot() method.</p>
<p><code>fit_arc_gam_1()</code> Finds single GAM model fit and it's first derivative for a single feature and one or several archetypes.</p>
<p><code>get_top_decreasing()</code> Find genes highest at each archetype above p-values threshold, and print top-12 genes and top-3 gene sets for each archetype.</p>
<p><code>find_decreasing_wilcox()</code> find features that are a decreasing function of distance from archetype by finding features with highest value (median) in bin closest to archetype (1 vs all Wilcox test).</p>
<p><code>bin_cells_by_arch()</code> find which cells are in bin closest to archetype.</p>
<p><code>find_tradeoff_wilcox()</code>: find features that are most different between 2 archetypes (at a tradeoff, DE, differentially expressed genes) by finding features with highest value (median) in bin closest to archetype (1 vs all Wilcox test).</p>
    
    </div>

    <pre class="usage"><span class='fu'>find_decreasing</span>(<span class='no'>data_attr</span>, <span class='no'>arc_col</span>, <span class='kw'>features</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>"Gpx1"</span>, <span class='st'>"Alb"</span>, <span class='st'>"Cyp2e1"</span>,
  <span class='st'>"Apoa2"</span>)[<span class='fl'>3</span>], <span class='kw'>min.sp</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='fl'>60</span>), <span class='kw'>N_smooths</span> <span class='kw'>=</span> <span class='fl'>4</span>, <span class='kw'>n_points</span> <span class='kw'>=</span> <span class='fl'>200</span>,
  <span class='kw'>d</span> <span class='kw'>=</span> <span class='fl'>1</span>/<span class='no'>n_points</span>, <span class='kw'>weights</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/rep'>rep</a></span>(<span class='fl'>1</span>, <span class='kw'>each</span> <span class='kw'>=</span> <span class='no'>n_points</span>), <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/rep'>rep</a></span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='fl'>1</span>, <span class='fl'>0</span>),
  <span class='kw'>each</span> <span class='kw'>=</span> <span class='no'>n_points</span>/<span class='fl'>2</span>))[<span class='fl'>1</span>], <span class='kw'>return_only_summary</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>stop_at_10</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>one_arc_per_model</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>"s"</span>, <span class='st'>"m"</span>,
  <span class='st'>"cmq"</span>)[<span class='fl'>1</span>], <span class='kw'>clust_options</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(), <span class='no'>...</span>)

<span class='fu'>fit_arc_gam_1</span>(<span class='no'>feature</span>, <span class='no'>col</span>, <span class='no'>N_smooths</span>, <span class='no'>data_attr</span>, <span class='no'>min.sp</span>, <span class='no'>...</span>, <span class='no'>d</span>, <span class='no'>n_points</span>,
  <span class='no'>weights</span>)

<span class='fu'>get_top_decreasing</span>(<span class='no'>summary_genes</span>, <span class='kw'>summary_sets</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>cutoff_genes</span> <span class='kw'>=</span> <span class='fl'>0.01</span>, <span class='kw'>cutoff_sets</span> <span class='kw'>=</span> <span class='fl'>0.01</span>,
  <span class='kw'>cutoff_metric</span> <span class='kw'>=</span> <span class='st'>"wilcoxon_p_val"</span>, <span class='kw'>p.adjust.method</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>"fdr"</span>,
  <span class='st'>"none"</span>)[<span class='fl'>1</span>], <span class='kw'>gam_fit_pval</span> <span class='kw'>=</span> <span class='fl'>0.01</span>, <span class='kw'>invert_cutoff</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>order_by</span> <span class='kw'>=</span> <span class='st'>"mean_diff"</span>, <span class='kw'>order_decreasing</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>min_max_diff_cutoff_g</span> <span class='kw'>=</span> <span class='fl'>0.3</span>, <span class='kw'>min_max_diff_cutoff_f</span> <span class='kw'>=</span> <span class='fl'>0.1</span>)

<span class='fu'>find_decreasing_wilcox</span>(<span class='no'>data_attr</span>, <span class='no'>arc_col</span>, <span class='kw'>features</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>"Gpx1"</span>, <span class='st'>"Alb"</span>,
  <span class='st'>"Cyp2e1"</span>, <span class='st'>"Apoa2"</span>)[<span class='fl'>3</span>], <span class='kw'>bin_prop</span> <span class='kw'>=</span> <span class='fl'>0.1</span>, <span class='kw'>na.rm</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>"s"</span>,
  <span class='st'>"m"</span>, <span class='st'>"cmq"</span>)[<span class='fl'>1</span>], <span class='kw'>clust_options</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(), <span class='kw'>method</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>"BioQC"</span>,
  <span class='st'>"r_stats"</span>)[<span class='fl'>1</span>])

<span class='fu'>bin_cells_by_arch</span>(<span class='no'>data_attr</span>, <span class='no'>arc_col</span>, <span class='kw'>bin_prop</span> <span class='kw'>=</span> <span class='fl'>0.1</span>,
  <span class='kw'>return_names</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)

<span class='fu'>find_tradeoff_wilcox</span>(<span class='no'>data_attr</span>, <span class='kw'>arc_col</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>"archetype_1"</span>,
  <span class='st'>"archetype_2"</span>), <span class='kw'>features</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>"Gpx1"</span>, <span class='st'>"Alb"</span>, <span class='st'>"Cyp2e1"</span>, <span class='st'>"Apoa2"</span>)[<span class='fl'>3</span>],
  <span class='kw'>bin_prop</span> <span class='kw'>=</span> <span class='fl'>0.1</span>, <span class='kw'>na.rm</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data_attr</th>
      <td><p>data.table dim(examples, dimensions) that includes distance of each example to archetype in columns given by <code>arc_col</code> and feature values given by <code>features</code></p></td>
    </tr>
    <tr>
      <th>arc_col</th>
      <td><p>character vector, columns that give distance to archetypes (column per archetype)</p></td>
    </tr>
    <tr>
      <th>features</th>
      <td><p>character vector (1L), column than containg feature values</p></td>
    </tr>
    <tr>
      <th>min.sp</th>
      <td><p>lower bound for the smoothing parameter, details: <a href='https://www.rdocumentation.org/packages/mgcv/topics/gam'>gam</a>. Default value of 60 works well to stabilise curve shape near min and max distance</p></td>
    </tr>
    <tr>
      <th>N_smooths</th>
      <td><p>number of bases used to represent the smooth term (<a href='https://www.rdocumentation.org/packages/mgcv/topics/s'>s</a>), 4 for cubic splines</p></td>
    </tr>
    <tr>
      <th>n_points</th>
      <td><p>number of points at which to evaluate derivative</p></td>
    </tr>
    <tr>
      <th>d</th>
      <td><p>numeric vector (1L), finite difference interval</p></td>
    </tr>
    <tr>
      <th>weights</th>
      <td><p>how to weight points along x axis when calculating mean (integral) probability. Useful if you care that the function is decreasing near the archetype but not far away. Two defaults suggest to weight point equally or discard bottom 50 percent.</p></td>
    </tr>
    <tr>
      <th>return_only_summary</th>
      <td><p>return only summary data.table containing p-values for each feature at each archetype and effect-size measures (average derivative).</p></td>
    </tr>
    <tr>
      <th>stop_at_10</th>
      <td><p>prevents <code>find_decreasing()</code> from fitting too many features</p></td>
    </tr>
    <tr>
      <th>one_arc_per_model</th>
      <td><p>If TRUE fit separate gam models for each archetype. If FALSE combine all archetypes in one model: feature ~ s(arc1) + s(arc2) + ... + s(arcN).</p></td>
    </tr>
    <tr>
      <th>type</th>
      <td><p>one of s, m, cmq. s means single core processing using lapply. m means multi-core parallel procession using parLapply. cmq means multi-node parallel processing on a computing cluster using clustermq package.</p></td>
    </tr>
    <tr>
      <th>clust_options</th>
      <td><p>list of options for parallel processing. The default for "m" is list(cores = parallel::detectCores()-1, cluster_type = "PSOCK"). The default for "cmq" is list(memory = 2000, template = list(), n_jobs = 10, fail_on_error = FALSE). Change these options as required.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>arguments passed to <a href='https://www.rdocumentation.org/packages/mgcv/topics/gam'>gam</a></p></td>
    </tr>
    <tr>
      <th>summary_genes</th>
      <td><p>gam_deriv summary data.table for decreasing genes</p></td>
    </tr>
    <tr>
      <th>summary_sets</th>
      <td><p>gam_deriv summary data.table for decreasing gene sets</p></td>
    </tr>
    <tr>
      <th>cutoff_genes</th>
      <td><p>value of cutoff_metric (lower bound) for genes</p></td>
    </tr>
    <tr>
      <th>cutoff_sets</th>
      <td><p>value of cutoff_metric (lower bound) for gene sets</p></td>
    </tr>
    <tr>
      <th>cutoff_metric</th>
      <td><p>probability metric for selecting decreasing genes: mean_prob, prod_prob, mean_prob_excl or prod_prob_excl</p></td>
    </tr>
    <tr>
      <th>p.adjust.method</th>
      <td><p>choose method for correcting p-value for multiple hypothesis testing. See p.adjust.methods and <a href='https://www.rdocumentation.org/packages/stats/topics/p.adjust'>p.adjust</a> for details.</p></td>
    </tr>
    <tr>
      <th>gam_fit_pval</th>
      <td><p>smooth term probability in gam fit (upper bound)</p></td>
    </tr>
    <tr>
      <th>invert_cutoff</th>
      <td><p>invert cutoff for genes and sets. If FALSE p &lt; cutoff_genes, if TRUE p &gt; cutoff_genes.</p></td>
    </tr>
    <tr>
      <th>order_by</th>
      <td><p>order decreasing feature list by measure in summary sets. By default is mean_diff, the average difference between cells in bin closest to archetype and all other cells. When using GAM instead of Wilcox test set this to one of c( "deriv100", "deriv50", "deriv20"), the average value of derivative at 20/50/100 percent of points closest to archetype.</p></td>
    </tr>
    <tr>
      <th>order_decreasing</th>
      <td><p>order significant categories using <code>order_by</code></p></td>
    </tr>
    <tr>
      <th>min_max_diff_cutoff_g</th>
      <td><p>what should be the mean difference (log-ratio, when y is log-space) of gene expression at the point closest to archetype compared to point furthest from archetype? When Wilcox method was used it is difference between mean of bin closest to archetype and all other cells. By default, at least 0.3 for genes and 0.1 for functions.</p></td>
    </tr>
    <tr>
      <th>min_max_diff_cutoff_f</th>
      <td><p>see min_max_diff_cutoff_g</p></td>
    </tr>
    <tr>
      <th>bin_prop</th>
      <td><p>proportion of data to put in bin closest to archetype</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>how to find_decreasing_wilcox()? Use <a href='https://www.rdocumentation.org/packages/BioQC/topics/wmwTest'>wmwTest</a> or <a href='https://www.rdocumentation.org/packages/stats/topics/wilcox.test'>wilcox.test</a>. BioQC::wmwTest can be up to 1000 times faster, so it is default.</p></td>
    </tr>
    <tr>
      <th>return_names</th>
      <td><p>return list of indices of cells or names of cells?</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code>find_decreasing()</code> list (S3 object, gam_deriv) containing summary p-values for features and each archetype, function call and (optionally) a data.table with values of the first derivative</p>
<p><code>fit_arc_gam_1()</code> list containing function call, 1st derivative values of GAM model (derivs), summary of GAM model (p-value and r^2, gam_sm)</p>
<p><code>get_top_decreasing()</code> print summary to output, and return list with character vector with one element for each archetype, and 2 data.table- with selection of enriched genes and functions.</p>
<p><code>find_decreasing_wilcox()</code> data.table containing p-values for each feature at each archetype and effect-size measures (average difference between bins). When log(counts) was used mean_diff reflects log-fold change.</p>
<p><code>bin_cells_by_arch()</code> list of indices of cells or names of cells that are in bin closest to each archetype</p>
<p><code>find_tradeoff_wilcox()</code> data.table containing p-values for each feature at each archetype and effect-size measures (average difference between bins). When log(counts) was used mean_diff reflects log-fold change.</p>
    

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>
          </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Vitalii Kleshchevnikov.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

