<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Classify cells with TensorFlow (logistic regression) — fit_logistic_model • ParetoTI</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Classify cells with TensorFlow (logistic regression) — fit_logistic_model" />

<meta property="og:description" content="fit_logistic_model() Uses TensorFlow to fit logistic regression model for classifying cells by attribute in colData slot of sce. Most arguments have sensible defaults. Use history plot to determine if model is learning and that it performs equally well on training and validation sets.
plot_confusion() plot confusion matrix: number of cells assigned to observed class and predicted class
predict_logistic_prob() predict class assignments of cells in SingleCellExperiment object. Genes used to train the model are selected automatically." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ParetoTI</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/Hepatocyte_example.html">Example of using archetypal analysis to find representative cells &amp; describe heterogeniety in hepatocyte population between those archetypes</a>
    </li>
  </ul>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Classify cells with TensorFlow (logistic regression)</h1>
    
    <div class="hidden name"><code>fit_logistic_model.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>fit_logistic_model() Uses TensorFlow to fit logistic regression model for classifying cells by attribute in colData slot of <code>sce</code>. Most arguments have sensible defaults. Use history plot to determine if model is learning and that it performs equally well on training and validation sets.</p>
<p>plot_confusion() plot confusion matrix: number of cells assigned to observed class and predicted class</p>
<p>predict_logistic_prob() predict class assignments of cells in SingleCellExperiment object. Genes used to train the model are selected automatically.</p>
    
    </div>

    <pre class="usage"><span class='fu'>fit_logistic_model</span>(<span class='no'>sce</span>, <span class='kw'>y</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>assay_slot</span> <span class='kw'>=</span> <span class='st'>"logcounts"</span>,
  <span class='kw'>y_col</span> <span class='kw'>=</span> <span class='st'>"Cell_class"</span>, <span class='kw'>activation</span> <span class='kw'>=</span> <span class='st'>"softmax"</span>,
  <span class='kw'>loss</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>"categorical_crossentropy"</span>, <span class='st'>"kullback_leibler_divergence"</span>)[<span class='fl'>1</span>],
  <span class='kw'>regularizer</span> <span class='kw'>=</span> <span class='kw pkg'>keras</span><span class='kw ns'>::</span><span class='no'><a href='https://www.rdocumentation.org/packages/keras/topics/regularizer_l1'>regularizer_l1</a></span>, <span class='kw'>penalty</span> <span class='kw'>=</span> <span class='fl'>0.01</span>,
  <span class='kw'>initializer</span> <span class='kw'>=</span> <span class='st'>"random_uniform"</span>, <span class='kw'>optimizer</span> <span class='kw'>=</span> <span class='kw pkg'>keras</span><span class='kw ns'>::</span><span class='fu'><a href='https://www.rdocumentation.org/packages/keras/topics/optimizer_sgd'>optimizer_sgd</a></span>(<span class='kw'>lr</span> <span class='kw'>=</span>
  <span class='fl'>0.01</span>, <span class='kw'>nesterov</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>), <span class='kw'>metrics</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='st'>"accuracy"</span>), <span class='kw'>epochs</span> <span class='kw'>=</span> <span class='fl'>100</span>,
  <span class='kw'>validation_split</span> <span class='kw'>=</span> <span class='fl'>0.3</span>, <span class='kw'>validation_split_per_class</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>callback_early_stopping_patience</span> <span class='kw'>=</span> <span class='fl'>50</span>, <span class='kw'>batch_size</span> <span class='kw'>=</span> <span class='fl'>1000</span>,
  <span class='kw'>shuffle</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>model</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)

<span class='fu'>plot_confusion</span>(<span class='no'>confusion</span>, <span class='kw'>normalize</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>text_color</span> <span class='kw'>=</span> <span class='st'>"grey60"</span>)

<span class='fu'>predict_logistic_prob</span>(<span class='no'>sce</span>, <span class='no'>model_res</span>, <span class='kw'>assay_slot</span> <span class='kw'>=</span> <span class='st'>"logcounts"</span>,
  <span class='kw'>ref_y</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>ref_y_col</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>batch_size</span> <span class='kw'>=</span> <span class='fl'>1000</span>,
  <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>sce</th>
      <td><p><a href='https://www.rdocumentation.org/packages/SingleCellExperiment/topics/SingleCellExperiment'>SingleCellExperiment</a> object.</p></td>
    </tr>
    <tr>
      <th>y</th>
      <td><p>Optionally, you can provide your own cell labels as <code>y</code> matrix (dim = cells * classes) where each row should sum to 1. This can be continuous cell labels such as those from archetypal analysis (<a href='fit_pch.html'>fit_pch</a>) or NMF (non-negativa matrix factorisation). In such case, kullback_leibler_divergence is a more suitable cost function.</p></td>
    </tr>
    <tr>
      <th>assay_slot</th>
      <td><p>Assay slot in <code>sce</code> containing gene expression matrix (default is logcounts).</p></td>
    </tr>
    <tr>
      <th>y_col</th>
      <td><p>Column in<code>colData(sce)</code> containing cell labels.</p></td>
    </tr>
    <tr>
      <th>activation</th>
      <td><p>Activation function. Using "softmax" gives logistic regression.</p></td>
    </tr>
    <tr>
      <th>loss</th>
      <td><p>Loss or Cost function that evaluates the difference between preditions and true labels and is minimised during model training. Use <code>"categorical_crossentropy"</code> for discrete class labels and <code>"kullback_leibler_divergence"</code> for continuous labels that sum to 1.</p></td>
    </tr>
    <tr>
      <th>regularizer</th>
      <td><p>Function to penalise high values of model parameters/weights and reduce overfitting (memorisation of the dataset). Details: <a href='https://www.rdocumentation.org/packages/keras/topics/regularizer_l1'>regularizer_l1</a>. L1 regularisation tends to push most weights to 0 (thus acting as feature selection method) and enforce sparse weights. L2 regularisation also reduces overfitting by keeping most weights small but does not shrink them to 0. Set to <code>NULL</code> to not regularise. Both weights and bias are regularised the same way.</p></td>
    </tr>
    <tr>
      <th>penalty</th>
      <td><p>Regularisation penalty between 0 and 1. The higher the penalty the more stringent is the regularisation. Very high values can lead to poor model performance due to high bias (limited flexibility). Sensible values: 0.01 for regularizer_l1 and 0.5 for regularizer_l2. Change this parameter based history plot to make sure the model performs equally well on training and validation sets.</p></td>
    </tr>
    <tr>
      <th>initializer</th>
      <td><p>Method of initialising weights and bias. You do not normally need to change this. See https://keras.io/initializers/ for details.</p></td>
    </tr>
    <tr>
      <th>optimizer</th>
      <td><p>Which optimiser should be used to fit the model. You do not normally need to change this. See https://keras.io/optimizers/ for details.</p></td>
    </tr>
    <tr>
      <th>metrics</th>
      <td><p>Metrics that evaluate performance of the model. Usually this is accuracy and loss function. See https://keras.io/metrics/ for details</p></td>
    </tr>
    <tr>
      <th>epochs</th>
      <td><p>Number of training epochs. You do not normally need to change this.</p></td>
    </tr>
    <tr>
      <th>validation_split</th>
      <td><p>What proportion of cells should be used for validation.</p></td>
    </tr>
    <tr>
      <th>validation_split_per_class</th>
      <td><p>Do the validation split within each class to maintains proportion of classes in training and validation sets (TRUE)?</p></td>
    </tr>
    <tr>
      <th>callback_early_stopping_patience</th>
      <td><p>Number of epochs to wait for improvement before stopping early.</p></td>
    </tr>
    <tr>
      <th>batch_size</th>
      <td><p>Look at data in batches of <code>batch_size</code> cells. All batches will be seen in each epoch.</p></td>
    </tr>
    <tr>
      <th>shuffle</th>
      <td><p>Logical, whether to shuffle the training data before each epoch? Details: <a href='https://www.rdocumentation.org/packages/keras/topics/fit.keras.engine.training.Model'>fit.keras.engine.training.Model</a></p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>Logical. Show and plot diagnosic output (TRUE)?</p></td>
    </tr>
    <tr>
      <th>model</th>
      <td><p>Provide your own keras/tensorflow model. Output units must be equal to the number of classes (columns of y), input_shape must be equal to nrow(sce). This can be used to extend logistic regression model by adding hidden layers</p></td>
    </tr>
    <tr>
      <th>confusion</th>
      <td><p>The confusion table generated by table(), OR the output of ParetoTI::fit_logistic_model(), OR the output of ParetoTI::predict_logistic_prob()</p></td>
    </tr>
    <tr>
      <th>normalize</th>
      <td><p>Normalise so that cell of each observed class sum to 1?</p></td>
    </tr>
    <tr>
      <th>text_color</th>
      <td><p>Color of on-plot text showing absolute numbers of cells.</p></td>
    </tr>
    <tr>
      <th>model_res</th>
      <td><p>Output of ParetoTI::fit_logistic_model(), class "logistic_model_fit_TF"</p></td>
    </tr>
    <tr>
      <th>ref_y</th>
      <td><p>Reference cell labels as <code>ref_y</code> matrix (dim = cells * classes) where each row should sum to 1. Optional, it can be used to match continuous cell labels across datasets.</p></td>
    </tr>
    <tr>
      <th>ref_y_col</th>
      <td><p>Reference class column in <code>colData(sce)</code>. For example, not annotated clusters assigned by a clustering algorhitm. Optional, it can be used to match discrete cell labels across datasets.</p></td>
    </tr>
    </table>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'># download PBMC data as SingleCellExperiment object

# split in 2 parts

# fit logistic regression model to 1st part

# use this model to predict cell types in the second part

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
            
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Vitalii Kleshchevnikov.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

