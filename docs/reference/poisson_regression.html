<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Poisson regression model to find effects of sample covariates on variables — poisson_regression • ParetoTI</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Poisson regression model to find effects of sample covariates on variables — poisson_regression" />

<meta property="og:description" content="Poisson regression models gene expression (Y) as a function of gene mean and sample covariates (X)
mu = beta * X
Y ~ Poisson(mu)" />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ParetoTI</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.13</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/Comparison_to_kmeans.html">Comparison of achetypal analysis and k-means clustering</a>
    </li>
    <li>
      <a href="../articles/Hepatocyte_example.html">Example of using archetypal analysis to find representative cells &amp; describe heterogeniety in hepatocyte population between those archetypes</a>
    </li>
  </ul>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Poisson regression model to find effects of sample covariates on variables</h1>
    
    <div class="hidden name"><code>poisson_regression.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Poisson regression models gene expression (Y) as a function of gene mean and sample covariates (X)
mu = beta * X
Y ~ Poisson(mu)</p>
    
    </div>

    <pre class="usage"><span class='fu'>compute_gene_deviance</span>(<span class='no'>data</span>, <span class='kw'>family</span> <span class='kw'>=</span> <span class='st'>"poisson"</span>, <span class='kw'>covar</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>precision</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>"double"</span>, <span class='st'>"single"</span>), <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>optimiser</span> <span class='kw'>=</span> <span class='kw pkg'>greta</span><span class='kw ns'>::</span><span class='fu'><a href='https://www.rdocumentation.org/packages/greta/topics/optimisers'>adam</a></span>(), <span class='kw'>max_iterations</span> <span class='kw'>=</span> <span class='fl'>5000</span>,
  <span class='kw'>tolerance</span> <span class='kw'>=</span> <span class='fl'>1e-06</span>)

<span class='fu'>poisson_regression</span>(<span class='no'>data</span>, <span class='kw'>covar</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>beta_mean</span> <span class='kw'>=</span> <span class='fl'>0</span>, <span class='kw'>beta_sd</span> <span class='kw'>=</span> <span class='fl'>3</span>,
  <span class='kw'>precision</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>"double"</span>, <span class='st'>"single"</span>))</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data</th>
      <td><p>data matrix (data points * dimensions), can be dense and sparse matrix, SummarizedExperiment/SingleCellExperiment, Seurat (counts slot is used). <code>poisson_regression()</code> accepts only a dense matrix at the moment (limitation of greta).</p></td>
    </tr>
    <tr>
      <th>family</th>
      <td><p>character naming the data distribution</p></td>
    </tr>
    <tr>
      <th>covar</th>
      <td><p>matrix (data points * covariates) or vector of column names (for compute_gene_deviance() and SingleCellExperiment, Seurat) containing covariates affecting expression in addition to gene mean (coverage, batch). Adding this will find genes whose deviance (residuals) is unexplained both by these covariates and Poisson noise (covar = NULL tests Poisson noise alone).</p></td>
    </tr>
    <tr>
      <th>precision</th>
      <td><p>argument for <a href='https://www.rdocumentation.org/packages/greta/topics/model'>model</a>. Use "single" for large datasets to reduce memory footprint</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>logical, plot greta model structure and print messages?</p></td>
    </tr>
    <tr>
      <th>optimiser</th>
      <td><p>method to use for finding regression coefficients and deviance when adding covariates see <a href='https://www.rdocumentation.org/packages/greta/topics/inference'>opt</a></p></td>
    </tr>
    <tr>
      <th>max_iterations</th>
      <td><p>number of iterations to run optimiser for.</p></td>
    </tr>
    <tr>
      <th>tolerance</th>
      <td><p>the numerical tolerance for the solution, the optimiser stops when the (absolute) difference in the joint density between successive iterations drops below this level.</p></td>
    </tr>
    <tr>
      <th>beta_mean</th>
      <td><p>prior mean for coefficients</p></td>
    </tr>
    <tr>
      <th>beta_sd</th>
      <td><p>prior sd for coefficients, use small values to regularise (e.g. penalise coefficients that deviate too much from 0)</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code>compute_gene_deviance()</code>: list containing the deviance vector with dimension names (genes) as names, beta coefficient matrix (dimensions * coeffs) and greta model used to compute those. For SingleCellExperiment the same object with beta coeffecients and deviance as rowData is returned. For Seurat the same object is returned updated with beta coeffecients and deviance in <code>Seurat::GetAssay(obj, "RNA")@meta.features</code>.</p>
<p><code>poisson_regression()</code>: R environment containing the model and parameters as greta arrays</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># Use fake data as example</span>
<span class='co'># Random data that fits into the triangle</span>
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/Random'>set.seed</a></span>(<span class='fl'>4355</span>)
<span class='no'>arc_data</span> <span class='kw'>=</span> <span class='fu'><a href='generate_arc.html'>generate_arc</a></span>(<span class='kw'>arc_coord</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='fl'>7</span>, <span class='fl'>3</span>, <span class='fl'>10</span>), <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='fl'>12</span>, <span class='fl'>17</span>, <span class='fl'>11</span>), <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='fl'>30</span>, <span class='fl'>20</span>, <span class='fl'>9</span>)),
                        <span class='kw'>mean</span> <span class='kw'>=</span> <span class='fl'>0</span>, <span class='kw'>sd</span> <span class='kw'>=</span> <span class='fl'>1</span>)
<span class='no'>data</span> <span class='kw'>=</span> <span class='fu'><a href='generate_arc.html'>generate_data</a></span>(<span class='no'>arc_data</span>$<span class='no'>XC</span>, <span class='kw'>N_examples</span> <span class='kw'>=</span> <span class='fl'>1e4</span>, <span class='kw'>jiiter</span> <span class='kw'>=</span> <span class='fl'>0.04</span>, <span class='kw'>size</span> <span class='kw'>=</span> <span class='fl'>0.9</span>)
<span class='co'># Take Poisson sample with the mean defined by each entry of the data matrix</span>
<span class='co'># (this create Poisson-distributed positive integer data)</span>
<span class='no'>data</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/matrix'>matrix</a></span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/stats/topics/Poisson'>rpois</a></span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/length'>length</a></span>(<span class='no'>data</span>), (<span class='no'>data</span>)), <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/nrow'>nrow</a></span>(<span class='no'>data</span>), <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/nrow'>ncol</a></span>(<span class='no'>data</span>))

<span class='co'># Compute deviance from the mean (residuals for Poisson data)</span>
<span class='no'>dev</span> <span class='kw'>=</span> <span class='fu'>compute_gene_deviance</span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/t'>t</a></span>(<span class='no'>data</span>))
<span class='co'># As you can see, the third dimension has lowest deviance</span>
<span class='no'>dev</span></div><div class='output co'>#&gt; $deviance
#&gt; [1] 19179.31 16610.19 10733.26
#&gt; 
#&gt; $beta
#&gt;      beta_mean
#&gt; [1,]  2.639314
#&gt; [2,]  2.546119
#&gt; [3,]  2.158645
#&gt; 
#&gt; $model
#&gt; NULL
#&gt; </div><div class='input'><span class='co'># because the vertices of the triangle have almost identical position in third dimension.</span>
<span class='fu'><a href='plot_arc.html'>plot_arc</a></span>(<span class='kw'>arc_data</span> <span class='kw'>=</span> <span class='no'>arc_data</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>data</span>,
         <span class='kw'>which_dimensions</span> <span class='kw'>=</span> <span class='fl'>1</span>:<span class='fl'>3</span>, <span class='kw'>data_alpha</span> <span class='kw'>=</span> <span class='fl'>0.5</span>)</div><div class='output co'>#&gt; <span class='message'>No trace type specified:</span>
#&gt; <span class='message'>  Based on info supplied, a 'scatter3d' trace seems appropriate.</span>
#&gt; <span class='message'>  Read more about this trace type -&gt; https://plot.ly/r/reference/#scatter3d</span></div><div class='output co'>#&gt; <span class='message'>A marker object has been specified, but markers is not in the mode</span>
#&gt; <span class='message'>Adding markers to the mode...</span></div><div class='input'># You can use deviance to find which dimension have variability to be explained with Archetypal Analysis

# Create a probabilistic Poisson regression model with greta
# to study effects of covariates on Poisson data (requires greta installed)
</div><span class='co'># NOT RUN {</span>
<span class='no'>model</span> <span class='kw'>=</span> <span class='fu'>poisson_regression</span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/t'>t</a></span>(<span class='no'>data</span>),
                     <span class='kw'>covar</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/matrix'>matrix</a></span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/stats/topics/Normal'>rnorm</a></span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/nrow'>ncol</a></span>(<span class='no'>data</span>)), <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/nrow'>ncol</a></span>(<span class='no'>data</span>), <span class='fl'>1</span>))
<span class='co'># plot the structure of tensorflow computation graph</span>
<span class='fu'><a href='https://www.rdocumentation.org/packages/graphics/topics/plot'>plot</a></span>(<span class='no'>model</span>$<span class='no'>model</span>)

<span class='co'># find parameters using adam optimiser</span>
<span class='no'>res</span> <span class='kw'>=</span> <span class='kw pkg'>greta</span><span class='kw ns'>::</span><span class='fu'><a href='https://www.rdocumentation.org/packages/greta/topics/inference'>opt</a></span>(<span class='no'>model</span>$<span class='no'>model</span>, <span class='kw'>optimiser</span> <span class='kw'>=</span> <span class='kw pkg'>greta</span><span class='kw ns'>::</span><span class='fu'><a href='https://www.rdocumentation.org/packages/greta/topics/optimisers'>adam</a></span>(), <span class='kw'>max_iterations</span> <span class='kw'>=</span> <span class='fl'>500</span>)
<span class='co'># did the model converge before 500 iterations?</span>
<span class='no'>res</span>$<span class='no'>iterations</span>
<span class='co'># Value of Poisson negative log likelihood (see greta documentation for details)</span>
<span class='no'>res</span>$<span class='no'>value</span>
<span class='co'># View beta parameters for each dimension (columns), log(mean) in the first row,</span>
<span class='co'># covariate coefficients in the subsequent rows</span>
<span class='no'>res</span>$<span class='no'>par</span>$<span class='no'>beta</span>
<span class='co'># }</span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    <p>Vitalii Kleshchevnikov</p>
  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Vitalii Kleshchevnikov.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

